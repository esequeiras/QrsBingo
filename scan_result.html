<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escáner QR</title>
</head>
<body class="bg-gray-50 flex flex-col items-center justify-center min-h-screen">

  <h1>Escanear código QR</h1>
  <div id="reader" style="width: 300px; height: 300px;"></div>
  <p id="result"></p>
  <button id="startBtn">Iniciar cámara</button>
  <button id="stopBtn">Detener cámara</button>

  <!-- ✅ Cargar primero la librería oficial -->
  <script src="https://unpkg.com/html5-qrcode@2.3.9/minified/html5-qrcode.min.js"></script>

  <!-- ✅ Luego tu código -->
  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const result = document.getElementById('result');
    const html5QrCode = new Html5Qrcode("reader");
    let cameraId = null;

    async function startCamera() {
      try {
        const cameras = await Html5Qrcode.getCameras();
        if (cameras && cameras.length) {
          cameraId = cameras[0].id;
          await html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: 250 },
            decodedText => {
              result.textContent = "Código escaneado: " + decodedText;
              html5QrCode.stop();
            },
            errorMessage => {
              // puedes ignorar errores de lectura momentáneos
            }
          );
        }
      } catch (err) {
        console.error("Error al iniciar la cámara:", err);
        alert("Error al iniciar la cámara: " + err);
      }
    }

    function stopCamera() {
      html5QrCode.stop().then(() => {
        result.textContent = "Cámara detenida";
      });
    }

    startBtn.onclick = startCamera;
    stopBtn.onclick = stopCamera;
  </script>
</body>
</html>
